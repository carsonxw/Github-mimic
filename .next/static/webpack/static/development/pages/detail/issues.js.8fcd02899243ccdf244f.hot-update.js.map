{"version":3,"file":"static/webpack/static/development/pages/detail/issues.js.8fcd02899243ccdf244f.hot-update.js","sources":["webpack:///./components/SearchUser.jsx"],"sourcesContent":["import { Select, Spin } from 'antd';\nimport { useState, useCallback, useRef } from 'react';\nimport debounce from 'lodash/debounce'; \n\nimport api from '../lib/api';\n\nconst Option = Select.Option;\n\nfunction SearchUser({ onChange, value }) {\n    // { current: 0 }\n    //avoid closure\n    const lastFetchIdRef = useRef(0);\n    const [fetching, setFetching] = useState(false);\n    const [options, setOptions] = useState([]);\n\n    //debounce 防抖\n    const fetchUser = useCallback(debounce(value => {\n\n        lastFetchIdRef.current += 1;\n        const fetchId = lastFetchIdRef.current;\n\n        setFetching(true);\n        setOptions([]);\n\n        // !isServer\n        api.request({\n            url: `/search/users?q=${value}`\n        }).then(resp => {\n            console.log('user', resp);\n            if (fetchId !== lastFetchIdRef.current) {\n                return;\n            }\n            const data = resp.data.items.map(user => ({\n                text: user.login,\n                value: user.login\n            }));\n            \n            setFetching(false);\n            setOptions(data);\n        });\n    }, 500), []);\n\n    const handleChange = value => {\n        setOptions([]);\n        setFetching(false);\n\n        onChange(value);\n    }\n \n    return (\n        <Select\n            style={{ width: 200 }}\n            showSearch={true}\n            notFoundContent={\n                fetching ? \n                    <Spin size='small'/>\n                :\n                    <span>Nothing</span>\n            }\n            filterOption={false}\n            placeholder='Creator'\n            allowClear={true}\n            onSearch={fetchUser}\n            onChange={handleChange}\n        >\n            {\n                options.map(option => (\n                    <Option \n                        value={option.value}\n                        key={option.value}\n                    >\n                        {option.text}\n                    </Option>\n                ))\n            }\n        </Select>\n    )\n}\n\nexport default SearchUser ;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAbA;AAgBA;AAEA;AACA;AAFA;AADA;AAWA;AACA;AACA;;;;A","sourceRoot":""}